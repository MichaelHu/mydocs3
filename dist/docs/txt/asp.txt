ASP



修订内容    修订人  修订时间
初稿    胡大民  2010/11/20
        
 
目录
ASP 1
目录    2
1 语法  1
1.1 注释    1
1.2 变量声明和赋值  1
1.3 字符串及特殊符号    1
1.4 if语句  2
1.5 分支语句    2
1.6 循环语句    3
1.7 方法    3
2 VBScript类    4
2.1 构造函数和析构函数  4
2.2 代码参考    4
3 数据库操作    4
3.1 连接对象    4
3.2 数据集对象  5
4 常用方法  8
5 简单调试工具  8
6 相关资料  8

 
JavascriptS和VBScript都可以作为ASP的服务端脚本，两种脚本之间的函数可以互调。本文以VBScript作为ASP开发的主要语言进行介绍。
1 语法
关键词不分大小写。
变量名、函数名、过程名都不区分大小写。
1.1 注释
单引号
1.2 变量声明和赋值
Dim str,i
str = “hello, world!!”
i = 10
声明兼初始化的语法不支持，比如以下语句不支持：
Dim str = “hello, world!!”
但是可以这么写：
Dim str : str = “hello, world!!”
语句不以分号结尾。

若需要将变量赋值成一个对象，需要使用set语法，如下语句，将conn赋值成一个数据库连接对象，需要使用set：
Dim conn
Set conn = Server.Createobject("adodb.connection")

1.3 字符串及特殊符号
1.3.1 字符串格式
使用双引号包围
1.3.2 字符串连接
and符号，&
1.3.3 字符串转义
两个双引号
1.4 if语句
If 0 = StrComp(action, "showreqinfo") then
    Call get_request_info
End If
数字相等比较使用等号，而不是双等号。字符串比较使用字符串函数。

1.5 分支语句
不同于大部分其他语言使用switch和case关键字，ASP使用select和case关键字。语法如下：
d=weekday(date)
Select Case d
  Case 1
    document.write("Sleepy Sunday")
  Case 2
    document.write("Monday again!")
  Case 3
    document.write("Just Tuesday!")
  Case 4
    document.write("Wednesday!")
  Case 5
    document.write("Thursday...")
  Case 6
    document.write("Finally Friday!")
  Case else
    document.write("Super Saturday!!!!")
End Select

1.6 循环语句
For-Next
For I = 0 To 5
…
Next


For-Each-Next
For Each var In vars
    …
Next

Do-Loop
Do While i>0
    …
Loop
或者
Do
    …
Loop While i>0

1.7 方法
方法定义（VB）
Sub sub_name(arg)
    sub_body
End Sub
方法调用
第一种方式：
sub_name arg
注意方法参数传递不能使用括号。
第二种方式：
call sub_name(arg)
2 VBScript类
2.1 构造函数和析构函数
这两个函数都使用指定的函数名。
构造函数
Public Sub Class_Initialize()
    Call Connect()
End Sub

析构函数
Public Sub Class_Terminate()
    Call DisConnect()
End Sub

2.2 代码参考
与文档统一目录的.asp脚本文件：mydb.asp，使用类实现。
3 数据库操作
3.1 连接对象
Connection对象，使用Server.CreateObject方法创建的一个COM对象。常用方法包括Open, Close
3.1.4 Open方法
dim m_conn, dbpath
set m_conn = Server.createobject("adodb.connection")
dbpath = Server.MapPath("db/db.mdb")
m_conn.Open "driver={Microsoft Access Driver (*.mdb)};dbq=" & dbpath

3.2 数据集对象
Record Set对象是一个COM对象，可以通过以下语句创建：
Set m_rs = Server.createobject("adodb.RecordSet")

Connection.execute方法的返回值就是一个Record Set对象。
set m_rs = m_conn.execute(“select * from tb_name”)
SQL语句，如果遇到数据库关键词，则使用方括号转义，比如：
set m_rs = m_conn.execute(“select * from [tb_name]”)

3.2.1 方法
open 打开数据集
movenext 将记录指针从当前的位置向下移一行
moveprevious 将记录指针从当前的位置向上移一行
movefirst 将记录指针移到数据表第一行
movelast 将记录指针移到数据表最后一行
absoluteposition=N 将记录指针移到数据表第N行
absolutepage=N 将记录指针移到第N页的第一行
pagesize=N 设置每页为N条记录
pagecount 根据 pagesize 的设置返回总页数
recordcount 返回记录总数
bof 返回记录指针是否超出数据表首端，true表示是，false为否
eof 返回记录指针是否超出数据表末端，true表示是，false为否
delete 删除当前记录，但记录指针不会向下移动
addnew 添加记录到数据表末端
update 更新数据表记录
3.2.2 RecordSet.Open方法
recordset.Open Source,ActiveConnection,CursorType,LockType,Options
Source
Recordset 对象可以通过Source属性来连接Command对象。Source参数可以是一个Command对象名称、一段SQL命令、一个指定的数据表名称或是一个Stored Procedure。假如省略这个参数，系统则采用Recordset对象的Source属性。

ActiveConnection
Recordset对象可以通过ActiveConnection属性来连接Connection对象。这里的ActiveConnection可以是一个Connection对象或是一串包含数据库连接信息（ConnectionString）的字符串参数。

Recordset对象Open方法的CursorType参数表示将以什么样的游标类型启动数据，包括adOpenForwardOnly、adOpenKeyset、adOpenDynamic及adOpenStatic，分述如下：
常数    常数值  说明
adOpenForwardOnly   0   缺省值，启动一个只能向前移动的游标（Forward Only）。
adOpenKeyset    1   启动一个Keyset类型的游标。
adOpenDynamic   2   启动一个Dynamic类型的游标。
adOpenStatic    3   启动一个Static类型的游标。
3.2.3 属性
Recordset属性   adOpenForwardOnly   adOpenKeyset    adOpenDynamic   adOpenStatic
AbsolutePage    不支持  不支持  可读写  可读写
AbsolutePosition    不支持  不支持  可读写  可读写
ActiveConnection    可读写  可读写  可读写  可读写
BOF 只读    只读    只读    只读
Bookmark    不支持  不支持  可读写  可读写
CacheSize   可读写  可读写  可读写  可读写
CursorLocation  可读写  可读写  可读写  可读写
CursorType  可读写  可读写  可读写  可读写
EditMode    只读    只读    只读    只读
EOF 只读    只读    只读    只读
Fields              
                
Filter  可读写  可读写  可读写  可读写
LockType    可读写  可读写  可读写  可读写
MarshalOptions  可读写  可读写  可读写  可读写
MaxRecords  可读写  可读写  可读写  可读写
PageCount   不支持  不支持  只读    只读
PageSize    可读写  可读写  可读写  可读写
RecordCount 不支持  不支持  只读    只读
Source  可读写  可读写  可读写  可读写
State   只读    只读    只读    只读
Status  只读    只读    只读    只读
AddNew  支持    支持    支持    支持
CancelBatch 支持    支持    支持    支持
CancelUpdate    支持    支持    支持    支持
Clone   不支持  不支持      
Close   支持    支持    支持    支持
Delete  支持    支持    支持    支持
GetRows 支持    支持    支持    支持
Move    不支持  支持    支持    支持
MoveFirst   支持    支持    支持    支持
MoveLast    不支持  支持    支持    支持
MoveNext    支持    支持    支持    支持
MovePrevious    不支持  支持    支持    支持
NextRecordset   支持    支持    支持    支持
Open    支持    支持    支持    支持
Requery 支持    支持    支持    支持
Resync  不支持  不支持  支持    支持
Supports    支持    支持    支持    支持
Update  支持    支持    支持    支持
UpdateBatch 支持    支持    支持    支持
--------------------------------------------------------------
其中NextRecordset方法并不适用于Microsoft Access数据库。

4 常用方法
split(value, separator)

5 简单调试工具
参考与该文档同目录的三个.asp脚本。
mytest.asp
mydb.asp
debug.asp
6 相关资料
http://www.w3schools.com/ASP/default.asp
W3Schools上关于ASP的reference

http://www.w3schools.com/vbscript/default.asp
W3Schools上关于VBScript的reference

http://wenku.baidu.com/view/c716d3fe910ef12d2af9e790.html
ASP字符串函数大全

http://blog.sina.com.cn/s/blog_561be3720100ap3e.html
ASP的class

http://wenku.baidu.com/view/b948a74bcf84b9d528ea7a55.html
ASP数据库对象学习，学习Record Set对象的接口方法。

