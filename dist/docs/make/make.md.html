<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="/docs/markdown_res/css/markdown-7.css" />
    <link rel="stylesheet" type="text/css" href="/docs/markdown_res/css/nav.css" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <style type="text/css">
        img {max-width: 100%; border: 1px solid #eee; }
        pre, code {color: #048ebd; }
        li>p {display: block;}
        p>code, li>code {padding:0; font-size: 13px; color: red;}
    </style>
    <script type="text/javascript" src="/docs/markdown_res/js/jquery-1.9.1.js"></script>
</head>
<body>
    <div id="nav">
<a href="javascript:history.back()">返回 [ or Backspace ]</a>
    </div>

<h1> GNU make</h1>

<ul><li>Archive文件：linux的.a对应windows的.lib</li>
<li>中间目标文件：linux的.o对应windows的.obj</li></ul>
<p><code>make</code>执行时需要<code>Makefile</code>文件</p>
<p>windows提供类似工具<code>nmake</code>。<code>Cygwin</code>可以执行标准unix的Makefile</p>

<h2> Makefile</h2>
<blockquote><p> Makefile(s) are text files written in a certain prescribed syntax.  Together with Make Utility, it helps build a software from its source files,  a way to organize code, and its compilation and linking.</p></blockquote><p>大部分情况下，Makefile作用就是告诉<code>make</code>如何<code>编译和链接</code>一个程序。</p>
<pre><code>target: dependencies 
[tab] system command(s)
... </code></pre>
<ul><li>target是一个目标文件，可以是Object File，也可以是可执行文件。还可以是一个标签（Label）。</li>
<li>dependencies为生成那个target所需要的文件或目标。</li>
<li>command为make需要执行的命令，可以是任意shell命令。</li></ul>
<p>dependencies中如果有一个及以上的文件比target文件要新的话，command所定义的命令就会被执行。</p>
<p><code>reference: </code><a href="https://www.gnu.org/software/make/manual/make.html#Introduction">GNU Makefile</a></p>
<ol><li>第一个target是默认目标，所以clean不要放在第一个target位置</li>
<li>文件名，可以是<code>Makefile</code>（推荐），也可以是<code>makefile</code>。还可以是<code>GNUmakefile</code>（GMUMake专用）</li>
<li>注释，以<code>#</code>开头</li></ol>
<h3> examples 1</h3>
<p>Makefile:</p>
<pre><code>edit : main.o kbd.o command.o display.o 
    cc -o edit main.o kbd.o command.o display.o

main.o : main.c defs.h
    cc -c main.c
kbd.o : kbd.c defs.h command.h
    cc -c kbd.c
command.o : command.c defs.h command.h
    cc -c command.c
display.o : display.c defs.h
    cc -c display.c

clean :
     rm edit main.o kbd.o command.o display.o  </code></pre>
<p>编译并链接，生成可执行文件<code>edit</code>，命令行中输入：</p>
<pre><code>$ make </code></pre>
<p>删除可执行文件以及中间目标文件，命令行中输入：</p>
<pre><code>$ make clean      </code></pre>
<h3> examples 2</h3>
<p>长行使用<code>反斜线</code>作为行分隔符。</p>
<p>Makefile: </p>
<pre><code>edit : main.o kbd.o command.o display.o \
    insert.o search.o files.o utils.o
    cc -o edit main.o kbd.o command.o display.o \
        insert.o search.o files.o utils.o

main.o : main.c defs.h
    cc -c main.c
kbd.o : kbd.c defs.h command.h
    cc -c kbd.c
command.o : command.c defs.h command.h
    cc -c command.c
display.o : display.c defs.h buffer.h
    cc -c display.c
insert.o : insert.c defs.h buffer.h
    cc -c insert.c
search.o : search.c defs.h buffer.h
    cc -c search.c
files.o : files.c defs.h buffer.h command.h
    cc -c files.c
utils.o : utils.c defs.h
    cc -c utils.c

clean :
    rm edit main.o kbd.o command.o display.o \
       insert.o search.o files.o utils.o    </code></pre>
<h3> example 3</h3>
<p>变量使用，可以使Makefile变得更简单。</p>
<p>定义变量：</p>
<pre><code>objects = ... </code></pre>
<p>使用变量：</p>
<pre><code>$(objects) </code></pre>
<p>Makefile: </p>
<pre><code>objects = main.o kbd.o command.o display.o \
          insert.o search.o files.o utils.o

edit : $(objects)
        cc -o edit $(objects)
main.o : main.c defs.h
        cc -c main.c
kbd.o : kbd.c defs.h command.h
        cc -c kbd.c
command.o : command.c defs.h command.h
        cc -c command.c
display.o : display.c defs.h buffer.h
        cc -c display.c
insert.o : insert.c defs.h buffer.h
        cc -c insert.c
search.o : search.c defs.h buffer.h
        cc -c search.c
files.o : files.c defs.h buffer.h command.h
        cc -c files.c
utils.o : utils.c defs.h
        cc -c utils.c
clean :
        rm edit $(objects)    </code></pre>
<h3> example 4</h3>
<p>在dependencies中省略<code>.c</code>文件</p>
<p>Makefile: </p>
<pre><code>objects = main.o kbd.o command.o display.o \
          insert.o search.o files.o utils.o

edit : $(objects)
        cc -o edit $(objects)
main.o : defs.h
kbd.o : defs.h command.h
command.o : defs.h command.h
display.o : defs.h buffer.h
insert.o : defs.h buffer.h
search.o : defs.h buffer.h
files.o : defs.h buffer.h command.h
utils.o : defs.h

clean :
        rm edit $(objects)     </code></pre>
<h3> example 5</h3>
<p>以dependencies分组，将相同dependencies的target合并。稍显别扭。</p>
<p>Makefile: </p>
<pre><code>objects = main.o kbd.o command.o display.o \
          insert.o search.o files.o utils.o

edit : $(objects)
        cc -o edit $(objects)

$(objects) : defs.h
kbd.o command.o files.o : command.h
display.o insert.o search.o files.o : buffer.h

clean :
        rm edit $(objects)  </code></pre>

    <script type="text/javascript" src="/docs/markdown_res/bootstrap/js/bootstrap.js"></script>
</body>
</html>
<script type="text/javascript">
(function(){

document.title = $('h1').html() || '技术文档－258i.com';    

$(document).on('keydown', function(e){
    var BACKSPACE = 8,
        LEFT = 37;

    if(BACKSPACE == e.keyCode
        || BACKSPACE == e.which
        || LEFT == e.keyCode
        || LEFT == e.which){
        history.back();
    }
});

})();
</script>
<script type="text/javascript" src="/docs/markdown_res/js/scrollspy.js"></script>
