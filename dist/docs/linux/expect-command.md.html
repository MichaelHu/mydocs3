<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="/docs/markdown_res/css/markdown-7.css" />
    <link rel="stylesheet" type="text/css" href="/docs/markdown_res/css/nav.css" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <style type="text/css">
        img {max-width: 100%; border: 1px solid #eee; }
        pre, code {color: #048ebd; }
        li>p {display: block;}
        p>code, li>code {padding:0; font-size: 13px; color: red;}
    </style>
    <script type="text/javascript" src="/docs/markdown_res/js/jquery-1.9.1.js"></script>
</head>
<body>
    <div id="nav">
<a href="javascript:history.back()">返回 [ or Backspace ]</a>
    </div>

<h1> expect command</h1>
<p>hudamin</p>
<blockquote><p> 与可交互程序进行编程式对话，使得命令行自动化</p></blockquote><p><code>expect [ -dDinN ] [ -c cmds ] [ [ -[f|b] ] cmdfile ] [ args ]</code></p>
<p>可以用C或者C++编写，但最常用的还是Tcl语言编写脚本文件。</p>

<h2> 初阶例子</h2>
<ol><li>dialback<pre><code>spawn tip modem
expect "connected"
send "ATD$argv\r"
# modem takes a while to connect
set timeout 60
expect "CONNECT" </code></pre>
</li>
<li>todo </li></ol>
<h2> 初阶四个命令</h2>
<ol><li>spawn<p>启动子进程</p>
<pre><code>spawn ssh username@host </code></pre>
</li>
<li>expect<p>多路expect例子：</p>
<pre><code>set timeout 30

set username [lrange $argv 0 0]

if { $username == "" } {
    spawn ssh relay.258i.com
} else {
    spawn ssh $username@relay.258i.com
}

expect -re ".*ssl.*"
send "ssh hudamin@sub0.258i.com\r"
expect {
    -re ".*password:" {
        send "2ws\x24rf^yh\r"
    }
    -re ".*sub0\.258i\.com" {
        send ""
    }
}
interact  </code></pre>
</li>
<li>send<pre><code>send [-flag] string </code></pre>
<ul><li>如果string看起来像一个选项，可以在其前面添加<code>--</code>，告知send将其解析为一个字符串</li>
<li><code>-h</code>选项，模拟人输入的速度来发送，但需要设置send_human变量<pre><code>set send_human {.1 .3 1 .05 2}
send -h "I'm hungry.  Let's do lunch." </code></pre>
</li>
<li>关于转义，使用反斜线<code> \ </code>，比如<code>\x24, \044, \t, \r</code>等<pre><code>send "a\tb\tc\r" 
# $转义，避免取未知变量的值，使用\x24或\044，如传送"ab$"
send "ab\x24"
send "ab\044"  </code></pre>
</li></ul>
</li>
<li>interact<p>将当前进程的控制权交给用户，使得键盘输入传送给当前进程，当前进程的stdout和stderr返回给用户。</p>
</li></ol>
<h2> 其他命令</h2>
<ol><li>send_user</li></ol>

    <script type="text/javascript" src="/docs/markdown_res/bootstrap/js/bootstrap.js"></script>
</body>
</html>
<script type="text/javascript">
(function(){

document.title = $('h1').html() || '技术文档－258i.com';    

$(document).on('keydown', function(e){
    var BACKSPACE = 8;

    if(BACKSPACE == e.keyCode
        || BACKSPACE == e.which){
        history.back();
    }
});

})();
</script>
<script type="text/javascript" src="/docs/markdown_res/js/scrollspy.js"></script>
