<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="/docs/markdown_res/css/markdown-7.css" />
    <link rel="stylesheet" type="text/css" href="/docs/markdown_res/css/nav.css" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <style type="text/css">
        img {max-width: 100%; border: 1px solid #eee; }
        pre, code {color: #048ebd; }
        li>p {display: block;}
        p>code, li>code {padding:0; font-size: 13px; color: red;}
    </style>
    <script type="text/javascript" src="/docs/markdown_res/js/jquery-1.9.1.js"></script>
</head>
<body>
    <div id="nav">
<a href="javascript:history.back()">返回 [ or Backspace ]</a>
    </div>

<h1> Linux Shell Memo</h1>
<p>hudamin 2014</p>

<h2> IO重定向</h2>
<ul><li>1 - stdout</li>
<li>2 - stderr</li>
<li>& - stdout and stderr</li>
<li><code>>, >>, &lt;, &lt;&lt;, &amp;n, &amp;-, /dev/null</code></li></ul>
<h3> Examples</h3>
<blockquote><p> <code>>, >>, &lt;, &lt;&lt;</code>与文件描述符（不是文件名）相连接的时候，注意<code>不能有空格</code>！文件描述符 若在右侧，需要添加<code>&amp;</code>前缀。</p></blockquote><p>描述符的重设置<code>作用范围</code>，使用<code>exec</code>是全局的，其他都是临时的。</p>
<ol><li>basics<pre><code>1> filename
1>> filename
2> filename
2>> filename
&amp;> filename
&amp;>> filename
&amp;> /dev/null

# stderr 指向 stdout 
2>&amp;1

0&lt; filename
&lt; filename

grep search-word &lt; filename </code></pre>
</li>
<li><code>[j]&lt;>filename</code> <p>打开文件用于读写，并将该文件赋值给描述符j。如果filename不存在，则创建之。
如果没有提供描述符j，则默认使用0，即stdin</p>
<pre><code>echo 1234567890 > File
exec 3&lt;>File
read -n 4&lt;&amp;3
echo -n . >&amp;3
exec 3>&amp;-
cat File </code></pre>
</li>
<li>关闭文件描述符<pre><code># 关闭输入描述符n
n&lt;&amp;-

# 关闭stdin
0&lt;&amp;-
&lt;&amp;-

# 关闭输出描述符n
n>&amp;-

# 关闭stdout
1>&amp;-
>&amp;-

cat /etc/passwd >&amp;-
cat: standard output: Bad file descriptor </code></pre>
</li>
<li>多个IO重定向可合并<pre><code>command &lt; input-file > output-file
command1 | command2 | command3 > output-file  </code></pre>
</li>
<li>多路输出流可重定向至一个文件<pre><code>ls -yz >> command.log 2>&amp;1 </code></pre>
<p>以上代码可将错误选项信息也输出到command.log。但是，以下代码却不可以，<code>注意区别</code>：</p>
<pre><code>ls -yz 2>&amp;1 >> command.log </code></pre>
<p><code>如果是管道，又是另一种情况了：</code></p>
<pre><code>ls -yz | less 2>&amp;1 </code></pre>
<p>以上代码less中不会接收到错误信息，以下代码可以：</p>
<pre><code>ls -yz 2>&amp;1 | less  </code></pre>
<p>具体原因暂不明白，注意区别。</p>
</li>
<li><code>Child processes inherit open file descriptors. This is why pipes work</code>. To prevent <p>an fd from being inherited, close it.</p>
<p>以下代码<code>只重定向</code>stderr到pipe：</p>
<pre><code>exec 3>&amp;1
ls -l 2>&amp;1 >&amp;3 3>&amp;- | grep bad 3>&amp;-
exec 3>&amp;-  </code></pre>
</li></ol>
<h2> Here Documents</h2>
<blockquote><p> 在命令行中使用匿名文档</p></blockquote><p>格式如下：</p>
<pre><code>&lt;&lt;EndOfMessage
...
...
EndOfMessage </code></pre>
<ol><li>直接输出<pre><code>cat &lt;&lt;EOF
    Hello, World!
    My name is $NAME
    Yes
    No
EOF </code></pre>
<p>注意，EOF<code>前后</code>不能有空白字符，否则不被视为结束符。</p>
<p><code>$NAME</code>会进行变量替换。</p>
</li>
<li>不带参数替换的Here Document，只需将起始标志符用<code>单引号扩起来</code><pre><code>cat &lt;&lt;'EOF'
    Hello, World!
    My name is $NAME
    Yes
    No
EOF  </code></pre>
</li>
<li>捕获Here文档内容进入管道，使用命令组合：<pre><code>(
cat &lt;&lt;'EOF'
    Hello, World!
    My name is $NAME
    Yes
    No
EOF
) > output_file </code></pre>
</li>
<li>捕获Here文档内容进入变量，使用命令组合：<pre><code>STRING=$(
cat &lt;&lt;EOF
    Hello, World!
    My name is $NAME
    Yes
    No
EOF
) </code></pre>
</li>
<li>使用Here文档，提供交互指令<pre><code>rm docs.tar.gz
tar zcvf docs.tar.gz docs
ftp username@ftp.server.com &lt;&lt;EOF
cd wwwroot
ls
put docs.tar.gz
EOF   </code></pre>
</li></ol>
<h2> 算术运算</h2>
<p>以下几种方式都可以：</p>
<pre><code>(( z = z + 1 ))
(( z +=  10 ))
z=$(( z+1 )) </code></pre>
<p>注意，<code>((</code>和<code>))</code>内部的变量赋值比较自由，操作符前后可以有空格。</p>
<p>而，普通赋值，比如<code>z=$((...))</code>，<code>z和=之间</code>就不允许有空格。</p>



<h2> env</h2>
<blockquote><p> set and print environment</p></blockquote><pre><code>env [-i] [name=value ...] [utility [argument ...]] </code></pre>
<p><code>Examples:</code></p>
<ol><li>查看环境变量<pre><code>$ env
TERM_PROGRAM=Apple_Terminal
TERM=xterm-256color
SHELL=/bin/bash
...
HOME=/Users/hudamin
SHLVL=1
LOGNAME=hudamin
_=/usr/bin/env </code></pre>
</li>
<li>设置环境变量<pre><code>$ env PHP_CGI=/usr/bin/php-cgi ./webserv.out /Users/hudamin/projects/news/git-webapp/output 8500 debug </code></pre>
</li>
<li>NodeJs bin文件：<pre><code>#!/usr/bin/env node
var hello = require('hello-node');
hello.sayHello();   </code></pre>
</li></ol>
<h2> 网络命令</h2>
<h3> dig</h3>
<p>相比其他工具更全面的DNS信息查询工具。</p>
<pre><code>$ dig github.com

; &lt;&lt;>> DiG 9.8.3-P1 &lt;&lt;>> github.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 11179
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 4

;; QUESTION SECTION:
;github.com.            IN  A

;; ANSWER SECTION:
github.com.     17  IN  A   192.30.252.129

;; AUTHORITY SECTION:
github.com.     1214    IN  NS  ns4.p16.dynect.net.
github.com.     1214    IN  NS  ns2.p16.dynect.net.
github.com.     1214    IN  NS  ns3.p16.dynect.net.
github.com.     1214    IN  NS  ns1.p16.dynect.net.

;; ADDITIONAL SECTION:
ns1.p16.dynect.net. 84132   IN  A   208.78.70.16
ns2.p16.dynect.net. 84132   IN  A   204.13.250.16
ns3.p16.dynect.net. 84132   IN  A   208.78.71.16
ns4.p16.dynect.net. 84132   IN  A   204.13.251.16

;; Query time: 41 msec
;; SERVER: 172.22.1.253#53(172.22.1.253)
;; WHEN: Fri Nov 21 12:27:12 2014
;; MSG SIZE  rcvd: 194  </code></pre>
<h3> nslookup</h3>
<pre><code>$ nslookup github.com
Server:     172.22.1.253
Address:    172.22.1.253#53

Non-authoritative answer:
Name:   github.com
Address: 192.30.252.130 </code></pre>
<h3> host</h3>
<pre><code>$ host github.com
github.com has address 192.30.252.131
github.com mail is handled by 10 ALT4.ASPMX.L.GOOGLE.com.
github.com mail is handled by 1 ASPMX.L.GOOGLE.com.
github.com mail is handled by 5 ALT1.ASPMX.L.GOOGLE.com.
github.com mail is handled by 5 ALT2.ASPMX.L.GOOGLE.com.
github.com mail is handled by 10 ALT3.ASPMX.L.GOOGLE.com.       </code></pre>

    <script type="text/javascript" src="/docs/markdown_res/bootstrap/js/bootstrap.js"></script>
</body>
</html>
<script type="text/javascript">
(function(){

document.title = $('h1').html() || '技术文档－258i.com';    

$(document).on('keydown', function(e){
    var BACKSPACE = 8,
        LEFT = 37;

    if(BACKSPACE == e.keyCode
        || BACKSPACE == e.which
        || LEFT == e.keyCode
        || LEFT == e.which){
        e.preventDefault();
        history.back();
    }
});

})();
</script>
<script type="text/javascript" src="/docs/markdown_res/js/scrollspy.js"></script>
